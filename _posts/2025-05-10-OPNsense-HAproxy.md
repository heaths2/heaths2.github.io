---
title: OPNsense HAProxy ì‚¬ìš©ë²•
author: G.G
date: 2025-05-10 21:01 +0900
categories: [Blog, Provisioning ]
tags: [Provisioning , HAProxy, Load balansing]
---

## ğŸ“˜ ê°œìš” (Overview)
ì´ ë¬¸ì„œëŠ” L4/L7 í•˜ë“œì›¨ì–´ ë¡œë“œë°¸ëŸ°ì„œì˜ ê³ ë¹„ìš© êµ¬ì¡°ë¥¼ ëŒ€ì²´í•˜ê³ ì, OPNsenseì˜ HAProxy í”ŒëŸ¬ê·¸ì¸ì„ í™œìš©í•˜ì—¬ ì†Œê·œëª¨ íŠ¸ë˜í”½ í™˜ê²½ì—ì„œ ê²½ì œì ì´ë©´ì„œë„ ì•ˆì •ì ì¸ ë¡œë“œë°¸ëŸ°ì‹±ì„ êµ¬í˜„í•œ ì‹¤ì œ ìš´ì˜ í™˜ê²½ ê¸°ë°˜ ë§¤ë‰´ì–¼ì…ë‹ˆë‹¤.

ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” HTTP íŠ¸ë˜í”½ì€ ê°€ìƒ IP (VIP: 10.1.1.101:80) ë¡œ ìˆ˜ì‹ ë˜ë©°, ì´ë¥¼ OPNsense ë‚´ HAProxyê°€ ë‚´ë¶€ WAS ì„œë²„(WAS1, WAS2)ë¡œ ì ì ˆí•˜ê²Œ ë¶„ì‚° ì²˜ë¦¬í•©ë‹ˆë‹¤.
ë³µì¡í•œ L7 ì •ì±… ì—†ì´ë„ ë‹¨ìˆœí•œ Round-Robin ë°©ì‹ìœ¼ë¡œ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜ì´ ê°€ëŠ¥í•˜ë©°, ì¥ì•  ì‹œì—ë„ HA êµ¬ì„±ëœ ë°©í™”ë²½ ë° OPNsense ì´ì¤‘í™”ë¡œ ê³ ê°€ìš©ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.

> ì´ êµ¬ì„±ì€ ë‹¤ìŒê³¼ ê°™ì€ í™˜ê²½ì— ì í•©í•©ë‹ˆë‹¤.
- ğŸ’¸ ê³ ê°€ì˜ ìƒìš© L4/L7 ë¡œë“œë°¸ëŸ°ì„œ ëŒ€ì²´
- ğŸ§© ì†Œê·œëª¨ ë˜ëŠ” ê°œë°œ/ìš´ì˜ í†µí•© ì¸í”„ë¼
- ğŸ–§ ë³µì¡í•˜ì§€ ì•Šì€ HTTP ê¸°ë°˜ íŠ¸ë˜í”½ ì²˜ë¦¬
- ğŸ” ë‹¨ìˆœí•œ ë¼ìš´ë“œë¡œë¹ˆ ë¶„ì‚° ë° í—¬ìŠ¤ì²´í¬ í•„ìš” ì‹œ

## ğŸ§± ì•„í‚¤í…ì²˜ (Architecture)

```bash
[Client]
   |
   v
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  FW (EX)   â•‘  â† ì™¸ë¶€ ë°©í™”ë²½ (HA êµ¬ì„±)
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•
   |
   v
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ OPNsense (HA êµ¬ì„±, HAProxy ì‚¬ìš©)   â•‘
â•‘ Virtual IP: 10.1.1.101:80           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   |
   v
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Internal FW (FW-IN, HA êµ¬ì„±)       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   |
   v
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           Internal Network          â•‘
â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘ â”‚ WAS1       â”‚   â”‚ WAS2       â”‚     â•‘
â•‘ â”‚ 10.1.11.101â”‚   â”‚ 10.1.11.102â”‚     â•‘
â•‘ â”‚   :8080    â”‚   â”‚   :8080    â”‚     â•‘
â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                     â•‘
â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘ â”‚ DB1        â”‚   â”‚ DB2        â”‚     â•‘
â•‘ â”‚ (ì˜ˆ: 5432) â”‚   â”‚ (ì˜ˆ: 5432) â”‚     â•‘
â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## âš™ï¸ ì‚¬ìš©ë²•

![ê·¸ë¦¼_1](/assets/img/2025-05-10/ê·¸ë¦¼1.png)
_OPNsense HAProxy plugin ì„¤ì¹˜_

![ê·¸ë¦¼_2](/assets/img/2025-05-10/ê·¸ë¦¼2.png)
_OPNsense HAProxy ì„œë¹„ìŠ¤ ì„ íƒ_

![ê·¸ë¦¼_3](/assets/img/2025-05-10/ê·¸ë¦¼3.png)
_OPNsense HAProxy ì„œë¹„ìŠ¤ í™œì„±í™”_

![ê·¸ë¦¼_4](/assets/img/2025-05-10/ê·¸ë¦¼4.png)
_OPNsense HAProxy Health ëª¨ë‹ˆí„° ì„ íƒ_

![ê·¸ë¦¼_5](/assets/img/2025-05-10/ê·¸ë¦¼5.png)
_OPNsense HAProxy Health ì„œë¹„ìŠ¤ í¬íŠ¸ ë“±ë¡_

![ê·¸ë¦¼_6](/assets/img/2025-05-10/ê·¸ë¦¼6.png)
_OPNsense HAProxy ì‹¤ì œ ì„œë¹„ìŠ¤ í•  ì„œë²„ ë“±ë¡ ì„ íƒ_

![ê·¸ë¦¼_7](/assets/img/2025-05-10/ê·¸ë¦¼7.png)
_OPNsense HAProxy ì‹¤ì œ ì„œë¹„ìŠ¤ í•  ì„œë²„ ë“±ë¡_

![ê·¸ë¦¼_8](/assets/img/2025-05-10/ê·¸ë¦¼8.png)
_OPNsense HAProxy Backend í’€ ë“±ë¡ ì„ íƒ_

![ê·¸ë¦¼_9](/assets/img/2025-05-10/ê·¸ë¦¼9.png)
_OPNsense HAProxy Backend í’€ ë“±ë¡-1_

![ê·¸ë¦¼_10](/assets/img/2025-05-10/ê·¸ë¦¼10.png)
_OPNsense HAProxy Backend í’€ ë“±ë¡-2_

![ê·¸ë¦¼_11](/assets/img/2025-05-10/ê·¸ë¦¼11.png)
_OPNsense HAProxy Backend í’€ ë“±ë¡-3_

![ê·¸ë¦¼_12](/assets/img/2025-05-10/ê·¸ë¦¼12.png)
_OPNsense HAProxy Backend í’€ ë“±ë¡-4_

![ê·¸ë¦¼_13](/assets/img/2025-05-10/ê·¸ë¦¼13.png)
_OPNsense HAProxy Frontend ë“±ë¡ ì„ íƒ_

![ê·¸ë¦¼_14](/assets/img/2025-05-10/ê·¸ë¦¼14.png)
_OPNsense HAProxy Frontend ë“±ë¡-1_

![ê·¸ë¦¼_15](/assets/img/2025-05-10/ê·¸ë¦¼15.png)
_OPNsense HAProxy Frontend ë“±ë¡-2_

![ê·¸ë¦¼_16](/assets/img/2025-05-10/ê·¸ë¦¼16.png)
_OPNsense HAProxy ì„¤ì • ì ìš©_

![ê·¸ë¦¼_17](/assets/img/2025-05-10/ê·¸ë¦¼17.png)
_OPNsense HAProxy ì„¤ì • í™•ì¸_